<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Sorteio de Equipas</title>
<style>
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f4f1ec;
    color: #333;
    padding: 30px;
  }
  

  h2 {
    margin-top: 40px;
    color: #6b3e26;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    max-width: 800px;
    margin-bottom: 25px;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  }

  th {
    background: #6b3e26;
    color: #fff;
    font-weight: 600;
  }

  td, th {
    padding: 10px;
    border-bottom: 1px solid #eee;
  }

  tr:last-child td {
    border-bottom: none;
  }

  input {
    width: 90%;
    padding: 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    text-align: center;
  }

  input:focus {
    outline: none;
    border-color: #d29a2a;
    box-shadow: 0 0 0 2px rgba(210,154,42,0.2);
  }

  button {
    background: #d29a2a;
    color: #fff;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    transition: transform 0.1s ease, box-shadow 0.1s ease;
  }

  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
  }

  button:active {
    transform: translateY(1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  #ranking tr:nth-child(even) {
    background: #faf7f3;
  }

  #ranking tr:first-child {
    background: #6b3e26;
    color: #fff;
  }

  /* Destaque do l칤der */
  #ranking tr:nth-child(2) td:first-child::after {
    content: " 游끥";
  }

  @media (max-width: 600px) {
    body {
      padding: 15px;
    }

    table {
      font-size: 14px;
    }

    button {
      width: 100%;
      margin-bottom: 15px;
    }
  }
.session {
  font-size: 14px;
  color: #d29a2a;
  margin-top: 5px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 5px;
}
#copySession {
  font-size: 16px;
  vertical-align: middle;
}

// Fun칞칚o para ler query params
// ===== Fun칞칚o para ler par칙metros da URL =====
function getQueryParam(name) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(name);
}

// ===== Inicializa칞칚o do sessionId =====
let sessionIdFromUrl = getQueryParam("session"); // tenta ler da URL
let sessionId = sessionIdFromUrl || localStorage.getItem("sessionId");

if (!sessionId) {
  // gera um sessionId aleat칩rio
  sessionId = 'sess-' + Math.random().toString(36).substr(2, 9);
}

// salva no localStorage
localStorage.setItem("sessionId", sessionId);

// mostra no t칤tulo
document.getElementById("sessionDisplay").textContent = `Session: ${sessionId}`;

// ===== Colocar a data de hoje =====
const hoje = new Date();
const dia = String(hoje.getDate()).padStart(2, '0');
const mes = String(hoje.getMonth() + 1).padStart(2, '0');
const ano = hoje.getFullYear();
document.getElementById("dataHoje").textContent = `${dia}-${mes}-${ano}`;

</style>
</head>
<body>
<h1 class="titulo">
  Mix Cevada <span>By GOAT</span> - <span id="dataHoje"></span>
  <div id="sessionDisplay" class="session">
  Session: <span id="sessionIdText"></span>
  <button id="copySession" title="Copiar URL" style="border:none; background:none; cursor:pointer;">游늶</button>
</div>
</h1>

<h2>Equipas</h2>
<table>
<tr><th>Equipa</th><th>Jogador 1</th><th>Jogador 2</th></tr>
<tbody id="teams">
<script>
["A","B","C","D","E","F"].forEach((t, i) => {
  document.write(`
    <tr>
      <td>${t}</td>
      <td><input id="j${i}_1" oninput="guardarEquipas()"></td>
      <td><input id="j${i}_2" oninput="guardarEquipas()"></td>
    </tr>
  `);
});
</script>
</tbody>
</table>

<button onclick="sorteio()">游꽄 Sorteio</button>

<table id="games">
<tr>
  <th>Campo</th>
  <th>Equipa 1</th>
  <th>Pts</th>
  <th>Pts</th>
  <th>Equipa 2</th>
</tr>
</table>

<button onclick="calcular()">游늵 Calcular Classifica칞칚o</button>

<h2>Classifica칞칚o Final</h2>
<table id="ranking">
<tr>
<th>Equipa</th><th>Pontos</th><th>V</th><th>E</th><th>D</th><th>Dif</th>
</tr>
</table>

<script>
let teams = ["A","B","C","D","E","F"];
let jogos = [];

function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function sorteio() {
  const campos = ["Bar", "Meio", "Ponta"];

  // Atualiza os nomes das equipas com Jogador1 - Jogador2
  teams = [];
  for (let i = 0; i < 6; i++) {
    const j1 = document.getElementById(`j${i}_1`).value || `Jogador1_${i+1}`;
    const j2 = document.getElementById(`j${i}_2`).value || `Jogador2_${i+1}`;
    teams.push(`${j1} - ${j2}`);
  }

  jogos = []; // reinicia os jogos

  // Round-robin fixo para 6 equipas
  const jornadas = [
    [[0,1],[2,3],[4,5]], // Jornada 1
    [[0,2],[1,5],[3,4]], // Jornada 2
    [[0,3],[1,2],[4,5]], // Jornada 3
    [[0,4],[1,3],[2,5]], // Jornada 4
    [[0,5],[1,4],[2,3]], // Jornada 5
  ];

  const gamesDiv = document.getElementById("games");
  gamesDiv.innerHTML = "";

  // controlar campos usados por cada equipe
  let equipeCampos = Array.from({length:6}, ()=> new Set());

  jornadas.forEach((jornada, roundIndex) => {
    const roundTitle = document.createElement("h2");
    roundTitle.textContent = `Jornada ${roundIndex + 1}`;
    roundTitle.style.color = "#6b3e26";
    gamesDiv.appendChild(roundTitle);

    const table = document.createElement("table");
    table.innerHTML = `
      <tr>
        <th>Campo</th>
        <th>Equipa 1</th>
        <th>Pts</th>
        <th>Pts</th>
        <th>Equipa 2</th>
      </tr>
    `;

    // embaralhar ordem dos jogos na jornada
    const shuffledJornada = jornada.sort(() => Math.random() - 0.5);

    shuffledJornada.forEach((par, i) => {
      let jogo = [teams[par[0]], teams[par[1]]];

      // aleatoriamente trocar Equipa 1 e 2
      if (Math.random() > 0.5) jogo = [jogo[1], jogo[0]];

      // escolher campo garantindo que cada equipe jogue pelo menos uma vez em cada campo
      let campoEscolhido;
      for (let c of campos.sort(() => Math.random() - 0.5)) {
        if (!equipeCampos[par[0]].has(c) && !equipeCampos[par[1]].has(c)) {
          campoEscolhido = c;
          equipeCampos[par[0]].add(c);
          equipeCampos[par[1]].add(c);
          break;
        }
      }
      if (!campoEscolhido) {
        // se todas j치 jogaram, escolhe aleatoriamente
        campoEscolhido = campos[Math.floor(Math.random()*campos.length)];
      }

      jogos.push(jogo);

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${campoEscolhido}</td>
        <td>${jogo[0]}</td>
        <td><input type="number" id="a${jogos.length-1}" style="width:50px" oninput="guardarResultados()"></td>
        <td><input type="number" id="b${jogos.length-1}" style="width:50px" oninput="guardarResultados()"></td>
        <td>${jogo[1]}</td>
      `;
      table.appendChild(row);
    });

    gamesDiv.appendChild(table);
  });

  // salvar jogos no localStorage
  localStorage.setItem("jogos", JSON.stringify(jogos));
}




function guardarEquipas() {
  let equipas = [];

  for (let i = 0; i < 6; i++) {
    equipas.push({
      j1: document.getElementById(`j${i}_1`).value,
      j2: document.getElementById(`j${i}_2`).value
    });
  }

  localStorage.setItem("equipas", JSON.stringify(equipas));
}
function guardarResultados() {
  let resultados = jogos.map((_, i) => ({
    a: document.getElementById(`a${i}`)?.value || "",
    b: document.getElementById(`b${i}`)?.value || ""
  }));

  localStorage.setItem("resultados", JSON.stringify(resultados));
}
function calcular() {
  let stats = {};
  teams.forEach(t => stats[t] = {p:0,v:0,e:0,d:0,dif:0});

  jogos.forEach((jogo, i) => {
    let a = parseInt(document.getElementById(`a${i}`).value);
    let b = parseInt(document.getElementById(`b${i}`).value);
    if (isNaN(a) || isNaN(b)) return;

    stats[jogo[0]].dif += a - b;
    stats[jogo[1]].dif += b - a;

    if (a > b) {
      stats[jogo[0]].p += 3; stats[jogo[0]].v++;
      stats[jogo[1]].d++;
    } else if (b > a) {
      stats[jogo[1]].p += 3; stats[jogo[1]].v++;
      stats[jogo[0]].d++;
    } else {
      stats[jogo[0]].p++; stats[jogo[1]].p++;
      stats[jogo[0]].e++; stats[jogo[1]].e++;
    }
  });

  let ranking = Object.entries(stats)
    .sort((a,b) => b[1].p - a[1].p || b[1].dif - a[1].dif);

  document.getElementById("ranking").innerHTML =
    `<tr><th>Equipa</th><th>Pontos</th><th>V</th><th>E</th><th>D</th><th>Dif</th></tr>`;

  ranking.forEach(r => {
    document.getElementById("ranking").innerHTML += `
      <tr>
        <td>${r[0]}</td>
        <td>${r[1].p}</td>
        <td>${r[1].v}</td>
        <td>${r[1].e}</td>
        <td>${r[1].d}</td>
        <td>${r[1].dif}</td>
      </tr>
    `;
  });
}
window.onload = () => {
// Pegar a data de hoje
const hoje = new Date();
const dia = String(hoje.getDate()).padStart(2, '0');
const mes = String(hoje.getMonth() + 1).padStart(2, '0'); // meses come칞am em 0
const ano = hoje.getFullYear();

// Inserir no span
document.getElementById("dataHoje").textContent = `${dia}-${mes}-${ano}`;
let sessionId = localStorage.getItem("sessionId");
if (!sessionId) {
  // gera um ID aleat칩rio simples
  sessionId = 'sess-' + Math.random().toString(36).substr(2, 9);
  document.getElementById("sessionDisplay").textContent = `Session: ${sessionId}`;

  localStorage.setItem("sessionId", sessionId);
}
// mostra o sessionId
document.getElementById("sessionIdText").textContent = sessionId;

// adicionar funcionalidade de copiar
document.getElementById("copySession").onclick = () => {
  // URL completa com sessionId
  const url = `${window.location.origin}${window.location.pathname}?session=${sessionId}`;

  // copiar para o clipboard
  navigator.clipboard.writeText(url).then(() => {
    alert("URL copiada para a 치rea de transfer칡ncia!"); // opcional
  }).catch(() => {
    alert("N칚o foi poss칤vel copiar a URL.");
  });
};
console.log("Session ID:", sessionId); // para debug

  /* ===== Restaurar nomes das equipas ===== */
  const equipasGuardadas = localStorage.getItem("equipas");
  if (equipasGuardadas) {
    JSON.parse(equipasGuardadas).forEach((e, i) => {
      document.getElementById(`j${i}_1`).value = e.j1;
      document.getElementById(`j${i}_2`).value = e.j2;
    });
  }

  /* ===== Restaurar jogos e campos ===== */
  const jogosGuardados = localStorage.getItem("jogos");
  if (!jogosGuardados) return;

  jogos = JSON.parse(jogosGuardados);
  const campos = ["Bar", "Meio", "Ponta"];

  document.getElementById("games").innerHTML = `
    <tr>
      <th>Campo</th>
      <th>Equipa 1</th>
      <th>Pts</th>
      <th>Pts</th>
      <th>Equipa 2</th>
    </tr>
  `;

  jogos.forEach((jogo, i) => {
    document.getElementById("games").innerHTML += `
      <tr>
        <td>${campos[i % 3]}</td>
        <td>${jogo[0]}</td>
        <td><input type="number" id="a${i}" style="width:50px" oninput="guardarResultados()"></td>
        <td><input type="number" id="b${i}" style="width:50px" oninput="guardarResultados()"></td>
        <td>${jogo[1]}</td>
      </tr>
    `;
  });

  /* ===== Restaurar resultados ===== */
  const resultadosGuardados = localStorage.getItem("resultados");
  if (resultadosGuardados) {
    JSON.parse(resultadosGuardados).forEach((r, i) => {
      if (!r) return;
      document.getElementById(`a${i}`).value = r.a;
      document.getElementById(`b${i}`).value = r.b;
    });
  }
};
</script>

</body>
</html>